var clickURL="https://spectrum-backend.herokuapp.com/feeds/click";function sendMessage(a,b){chrome.tabs.query({active:true,currentWindow:true},function(c){var d=c[0].id;chrome.tabs.sendMessage(d,a,b)})}function addSpectrumEvents(){var e;var b=$(".spectrum-popup-body");var f=b.find(".spectrum-close");var g=b.find(".spectrum-minimize");var a=b.find(".spectrum-no-button");var c={action:"getLocalStorage",localValues:["hidden","hiddenIcon","unique_id"],};sendMessage(c,function(h){if(!h){h={currentArticle:undefined,hidden:undefined,hiddenIcon:undefined,unique_id:undefined,}}e=h.currentArticle;if(e){b.removeClass("spectrum-disabled")}if(h.hidden==="spectrum-close"){f.filter(".spectrum-hide-panel").hide()}else{f.filter(".spectrum-show-option").hide()}if(h.hidden==="spectrum-minimize"){g.filter(".spectrum-hide-panel").hide()}else{g.filter(".spectrum-show-option").hide()}if(h.hiddenIcon){a.filter(".spectrum-hide-panel").hide()}else{a.filter(".spectrum-show-option").hide()}b.on("click.sendClick","li",function(j){var k="."+j.currentTarget.className.replace(/ /g,".");var i={element_selector:k,clicked_item_dict:JSON.stringify({element_class:k,element_data:j.currentTarget.dataset,element_text:j.currentTarget.textContent,}),clicked_version:chrome.runtime.getManifest().version,unique_id:h.unique_id,};$.ajax({url:clickURL,data:i,type:"POST",}).fail(function(m,l,n){console.log("Failed to save click");console.log("req",m);console.log("textstatus",l);console.log("errorthrown",n)}).done(function(l){console.log("Successfully saved click")})})});function d(i,h){if(i==="hidden"){if(h==="spectrum-minimize"){g.toggle()}else{f.toggle()}}else{a.toggle()}}b.find(".spectrum-get-involved > a").on("click.openEmail",function(h){h.preventDefault();chrome.tabs.query({active:true},function(i){chrome.tabs.update(i[0].id,{url:h.target.href})})});b.on("click.hidePanel",".spectrum-hide-panel",function(j){if($(j.target).closest(".spectrum-disabled").length){return}var i=j.target.dataset;var h={action:"hideSpectrumPanel",typeButton:i.hideType,showType:i.showType,};d(i.showType,i.hideType);sendMessage(h)});b.on("click.showPanel",".spectrum-show-option",function(i){if($(i.target).closest(".spectrum-disabled").length){return}var j=i.target.dataset.showType;var h={action:"showSpectrumPanel",showType:j,};d(j,i.target.dataset.hideType);sendMessage(h)})}document.addEventListener("DOMContentLoaded",function(){addSpectrumEvents()});