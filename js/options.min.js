var unique_id;var settingURL="https://spectrum-backend.herokuapp.com/feeds/saveuser";var clickURL="https://spectrum-backend.herokuapp.com/feeds/click";function getRandomToken(){var a=new Uint8Array(32);crypto.getRandomValues(a);var c="";for(var b=0;b<a.length;++b){c+=a[b].toString(16)}return c}function saveOptions(){var d=document.getElementById("hidden").value;var c=document.getElementById("hiddenIcon").checked?"spectrum-no-button":null;var e=document.getElementById("username").value;var b={hidden:d,hiddenIcon:c,username:e,is_internal_user:e.indexOf("test")>=0,};b.unique_id=unique_id;var a=document.getElementById("status");$.ajax({url:settingURL,data:b,type:"POST",}).fail(function(g,f,h){a.textContent="Failed to save settings: "+g.responseJSON.message;console.log("req",g);console.log("textstatus",f);console.log("errorthrown",h)}).done(function(f){chrome.storage.sync.set(b,function(){a.textContent=f.message;setTimeout(function(){a.textContent=""},1500)})})}function restoreOptions(){chrome.storage.sync.get({hidden:"",hiddenIcon:null,username:"",unique_id:"",},function(a){document.getElementById("hidden").value=a.hidden||"";document.getElementById("hiddenIcon").checked=!!a.hiddenIcon;document.getElementById("username").value=a.username;unique_id=a.unique_id;if(!unique_id){unique_id=username+"-"+getRandomToken()}$("#user-form").off("change.sendClick").on("change.sendClick",function(d){var c="#"+d.target.id;var b={element_selector:c,clicked_item_dict:JSON.stringify({element_id:d.target.id,element_name:d.target.name,value:d.target.value,}),clicked_version:chrome.runtime.getManifest().version,unique_id:unique_id,};$.ajax({url:clickURL,data:b,type:"POST",}).fail(function(f,e,g){console.log("Failed to save click");console.log("req",f);console.log("textstatus",e);console.log("errorthrown",g)}).done(function(e){console.log("Successfully saved click")})})})}document.addEventListener("DOMContentLoaded",restoreOptions);document.getElementById("save").addEventListener("click",saveOptions);