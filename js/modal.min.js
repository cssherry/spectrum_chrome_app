var feedbackUrl="https://spectrum-backend.herokuapp.com/feeds/feedback";var SpectrumModal={init:function(){var a=this;render("../html/modal.html",undefined,function(b){a.$modal=b;a.$form=b.find("#spectrum-feedback-form");a.$close=b.find(".close");a.$status=b.find("#status");a.$negativeOnly=b.find(".negative-only");a.$articleOnly=b.find(".article-only");a.$checkbox=b.find("input[type=checkbox]");a.$text=b.find("input[type=text], textarea");a.$type=b.find("spectrum-type");$("body").append(b);a.$form.on("submit.submitSpectrumFeedback",a._sendFeedback.bind(a));a.$close.on("click.closeSpectrumModal",function(c){c.preventDefault();a.$modal.hide()})});return a},setValue:function(a,b){this[a]=b},trigger:function(a){var b=this;if(!a){return b.$trigger}if(b.$trigger){b.$trigger.off("click.openSpectrumModal")}a.on("click.openSpectrumModal",".spectrum-open-modal",function(d){d.preventDefault();var c=$(d.target).closest(".spectrum-feedback-area");b.formProperties=Object.assign({},d.target.dataset,c.data());b.$checkbox.prop("checked",false);b.$text.val("");if(b.formProperties.associationId){b.$articleOnly.show();b.$type.text("Article")}else{b.$articleOnly.hide();b.$type.text("News Source")}if(b.formProperties.isNegative){b.$negativeOnly.show()}else{b.$negativeOnly.hide()}b.$modal.show()});return b;b.$trigger=a},_sendFeedback:function(b){b.preventDefault();var c=this;var a=this.formProperties;a.feedback_dict={currentURL:c.currentURL,fullURL:c.fullURL,};$(b.target).serializeArray().forEach(function(d){a.feedback_dict[d.name]=d.value});a.feedback_dict=JSON.stringify(a.feedback_dict);a.feedback_version=c.feedback_version;a.unique_id=c.unique_id;a.username=c.username;a.is_internal_user=c.is_internal_user;$.ajax({url:feedbackUrl,data:a,type:"POST",}).fail(function(e,d,f){if(e.responseJSON){c.$status.text("Failed to send feedback: "+e.responseJSON.message)}else{c.$status.text("Failed to send feedback")}c.$status.attr("class","spectrum-status-error");logError("Failed to send feedback",e,d,f)}).done(function(d){c.$status.text(d.message);c.$status.attr("class","spectrum-status-success");setTimeout(function(){c.$modal.hide();c.$status.text("");c.$status.attr("class","")},2000)});return false},};