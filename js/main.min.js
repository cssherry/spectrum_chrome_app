var publications;var mediaBias;var publicationUrl="https://spectrum-backend.herokuapp.com/feeds/publications";function processPublicationUrls(b){var a={};b.forEach(function(c){if(!c.fields.skip_scraping){a[cleanUrl(c.fields.base_url)]=c}});return a}function getAssociations(){var b=window.location;var a=spectrum.init(b,publications,mediaBias);chrome.runtime.onMessage.addListener(function(e,d,c){var f={};if(e.action==="hideSpectrumPanel"){f[e.showType]=e.typeButton;chrome.runtime.sendMessage({action:"setLocalStorage",localValues:f,});if(e.showType==="hidden"){a._hideContainer(e.typeButton)}else{a._hideIcon()}return true}else{if(e.action==="showSpectrumPanel"){f[e.showType]=null;chrome.runtime.sendMessage({action:"setLocalStorage",localValues:f,});if(e.showType==="hidden"){a._showContainer();a.getAssociations()}else{a._showIcon()}return true}else{if(e.action==="hasCurrentArticle"){c&&c(!!a.currentArticle)}}}})}chrome.runtime.sendMessage({action:"processValue",keyData:JSON.parse(localStorage.getItem("publications")),},function(a){publications=a;chrome.runtime.sendMessage({action:"getLocalStorage",localValues:["mediaBias"],},function(b){mediaBias=b.mediaBias;if(publications&&mediaBias){getAssociations()}else{$.ajax({url:publicationUrl,type:"GET",}).fail(function(d,c,e){logError("Failed to get publications and media biases",d,c,e)}).done(function(c){publications=processPublicationUrls(c.publications);mediaBias=c.media_bias;localStorage.setItem("publications",JSON.stringify({dateSaved:new Date().toString(),data:publications,}));chrome.runtime.sendMessage({action:"setLocalStorage",checkDate:true,localValues:{mediaBias:mediaBias,},})})}})});