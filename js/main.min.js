$(document).ready(function(){var publications=getLocalStorage("publications");var mediaBias=getLocalStorage("mediaBias");var publicationUrl="https://spectrum-backend.herokuapp.com/feeds/publications";function processPublicationUrls(pubs){var result={};pubs.forEach(function(p){if(!p.fields.skip_scraping){result[p.fields.base_url]=p}});return result}function getAssociations(){var currentLocation=window.location;var spectrumInstance=spectrum.init(currentLocation);chrome.runtime.onMessage.addListener(function(request){if(request.action==="hideSpectrumPanel"){setLocalStorage(request.showType,request.typeButton);if(request.showType==="hidden"){spectrumInstance._hideContainer(request.typeButton)}else{spectrumInstance._hideIcon()}}});chrome.runtime.onMessage.addListener(function(request){if(request.action==="showSpectrumPanel"){setLocalStorage(request.showType,null);if(request.showType==="hidden"){spectrumInstance._showContainer();spectrumInstance.getAssociations(2)}else{spectrumInstance._showIcon()}}});chrome.runtime.onMessage.addListener(function(request,sender,sendResponse){if(request.action==="getLocalStorage"){var results={};request.localValues.forEach(function(lv){results[lv]=getLocalStorage(lv)});results.currentPublication=spectrumInstance.currentPublication;sendResponse(results)}})}if(publications&&mediaBias){getAssociations()}else{$.ajax({url:publicationUrl,type:"GET"}).fail(function(req,textstatus,errorthrown){logError("Failed to get publications and media biases",req,textstatus,errorthrown)}).done(function(resp){publications=processPublicationUrls(resp.publications);mediaBias=resp.media_bias;setLocalStorage("publications",publications);setLocalStorage("mediaBias",mediaBias);getAssociations()})}});