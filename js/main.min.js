var publications=getLocalStorage("publications","March 25, 2017");var mediaBias=getLocalStorage("mediaBias");var publicationUrl="https://spectrum-backend.herokuapp.com/feeds/publications";function processPublicationUrls(b){var a={};b.forEach(function(c){if(!c.fields.skip_scraping){a[cleanUrl(c.fields.base_url)]=c}});return a}function getAssociations(){var b=window.location;var a=spectrum.init(b);chrome.runtime.onMessage.addListener(function(c){if(c.action==="hideSpectrumPanel"){setLocalStorage(c.showType,c.typeButton);if(c.showType==="hidden"){a._hideContainer(c.typeButton)}else{a._hideIcon()}}});chrome.runtime.onMessage.addListener(function(c){if(c.action==="showSpectrumPanel"){setLocalStorage(c.showType,null);if(c.showType==="hidden"){a._showContainer();a.getAssociations()}else{a._showIcon()}}});chrome.runtime.onMessage.addListener(function(f,e,c){if(f.action==="getLocalStorage"){var d={};f.localValues.forEach(function(g){d[g]=getLocalStorage(g)});d.currentArticle=a.currentArticle;c(d)}})}if(publications&&mediaBias){getAssociations()}else{$.ajax({url:publicationUrl,type:"GET",}).fail(function(b,a,c){logError("Failed to get publications and media biases",b,a,c)}).done(function(a){publications=processPublicationUrls(a.publications);mediaBias=a.media_bias;setLocalStorage("publications",publications);setLocalStorage("mediaBias",mediaBias);getAssociations()})};